<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Brain Quest: Final Version</title>
    <style>
        :root {
            --bg-body: #0f172a;
            --bg-panel: #1e293b;
            --accent: #8b5cf6;
            --snake-head: #10b981;
            --snake-body: #34d399;
            --wrong: #ef4444;
            --correct: #22c55e;
            --text-main: #f1f5f9;
            --grid-line: #334155;
        }

        * {
            box-sizing: border-box;
            touch-action: manipulation;
            font-family: 'Segoe UI', Roboto, sans-serif;
            user-select: none;
        }

        body {
            margin: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header-bar {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            background: var(--bg-panel);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--accent);
        }

        .hearts-container {
            display: flex;
            gap: 5px;
        }

        .heart {
            color: var(--wrong);
            font-size: 1.3rem;
        }

        .heart.lost {
            color: #475569;
            opacity: 0.3;
        }

        .question-panel {
            background: var(--bg-panel);
            width: 95%;
            max-width: 500px;
            padding: 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        #question-text {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .game-wrapper {
            position: relative;
            border: 4px solid var(--grid-line);
            border-radius: 15px;
            background: #020617;
            overflow: hidden;
        }

        canvas { display: block; }

        .controls {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(2, 70px);
            gap: 15px;
        }

        .nav-btn {
            background: #1e293b;
            border: 2px solid #475569;
            border-radius: 20px;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            cursor: pointer;
        }

        .nav-btn:active { background: var(--accent); }

        .btn-up { grid-column: 2; grid-row: 1; }
        .btn-left { grid-column: 1; grid-row: 2; }
        .btn-down { grid-column: 2; grid-row: 2; }
        .btn-right { grid-column: 3; grid-row: 2; }

        .overlay {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
            padding: 20px;
        }

        .hidden { display: none !important; }

        button.main-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
        }

        @keyframes pulse-red { 0% { background: #020617; } 50% { background: #450a0a; } 100% { background: #020617; } }
        .flash-red { animation: pulse-red 0.4s ease; }
    </style>
</head>
<body>

    <div class="header-bar">
        <div>
            <div style="font-size: 0.8rem; opacity: 0.7;">SKOR</div>
            <div id="score" style="font-weight: bold; font-size: 1.2rem;">0</div>
        </div>
        <div class="hearts-container" id="hearts"></div>
    </div>

    <div class="question-panel">
        <div id="question-text">Siap?</div>
    </div>

    <div class="game-wrapper" id="container">
        <canvas id="gameCanvas"></canvas>
        
        <div id="start-screen" class="overlay">
            <h1>SNAKE BRAIN</h1>
            <p>Makan jawaban yang benar.<br>Jangan menabrak badan sendiri!</p>
            <button class="main-btn" onclick="game.start()">MULAI</button>
        </div>

        <div id="over-screen" class="overlay hidden">
            <h1 style="color:var(--wrong)">GAME OVER</h1>
            <p id="reason"></p>
            <button class="main-btn" onclick="game.reset()">ULANGI</button>
        </div>
    </div>

    <div class="controls">
        <div class="nav-btn btn-up" onpointerdown="game.input('up')">▲</div>
        <div class="nav-btn btn-left" onpointerdown="game.input('left')">◀</div>
        <div class="nav-btn btn-down" onpointerdown="game.input('down')">▼</div>
        <div class="nav-btn btn-right" onpointerdown="game.input('right')">▶</div>
    </div>

<script>
    const quiz = [
        { q: "10 + 15 = ?", a: [{t:"25", c:true}, {t:"20", c:false}, {t:"30", c:false}] },
        { q: "Warna Pisang Matang?", a: [{t:"Kuning", c:true}, {t:"Merah", c:false}, {t:"Hijau", c:false}] },
        { q: "Ibukota Indonesia?", a: [{t:"Jakarta", c:true}, {t:"Bali", c:false}, {t:"Medan", c:false}] },
        { q: "5 x 5 = ?", a: [{t:"25", c:true}, {t:"20", c:false}, {t:"15", c:false}] }
    ];

    class Game {
        constructor() {
            this.canvas = document.getElementById('gameCanvas');
            this.ctx = this.canvas.getContext('2d');
            this.grid = 20;
            this.resize();
            this.resetState();
        }

        resize() {
            const size = Math.min(window.innerWidth - 40, 340);
            this.canvas.width = this.canvas.height = Math.floor(size / this.grid) * this.grid;
            this.tiles = this.canvas.width / this.grid;
        }

        resetState() {
            this.snake = [{x: 10, y: 10}, {x: 9, y: 10}];
            this.dir = {x: 1, y: 0};
            this.nextDir = {x: 1, y: 0};
            this.lives = 4;
            this.score = 0;
            this.level = 0;
            this.foods = [];
            this.running = false;
        }

        start() {
            this.resetState();
            document.querySelectorAll('.overlay').forEach(o => o.classList.add('hidden'));
            this.updateUI();
            this.spawn();
            this.running = true;
            if(this.int) clearInterval(this.int);
            this.int = setInterval(() => this.tick(), 150);
        }

        reset() { this.start(); }

        updateUI() {
            document.getElementById('score').innerText = this.score;
            const h = document.getElementById('hearts');
            h.innerHTML = '';
            for(let i=0; i<4; i++) {
                h.innerHTML += `<span class="heart ${i >= this.lives ? 'lost' : ''}">❤</span>`;
            }
            if(this.level < quiz.length) {
                document.getElementById('question-text').innerText = quiz[this.level].q;
            } else {
                this.win();
            }
        }

        spawn() {
            this.foods = [];
            if(this.level >= quiz.length) return;
            quiz[this.level].a.forEach(ans => {
                let pos;
                do {
                    pos = { x: Math.floor(Math.random()*this.tiles), y: Math.floor(Math.random()*this.tiles) };
                } while(this.snake.some(s => s.x === pos.x && s.y === pos.y));
                this.foods.push({...pos, text: ans.t, correct: ans.c});
            });
        }

        input(d) {
            const cur = this.dir;
            if(d === 'up' && cur.y === 0) this.nextDir = {x:0, y:-1};
            if(d === 'down' && cur.y === 0) this.nextDir = {x:0, y:1};
            if(d === 'left' && cur.x === 0) this.nextDir = {x:-1, y:0};
            if(d === 'right' && cur.x === 0) this.nextDir = {x:1, y:0};
        }

        tick() {
            if(!this.running) return;
            this.dir = this.nextDir;
            let head = { x: this.snake[0].x + this.dir.x, y: this.snake[0].y + this.dir.y };

            // Infinity Wall
            if(head.x < 0) head.x = this.tiles - 1;
            if(head.x >= this.tiles) head.x = 0;
            if(head.y < 0) head.y = this.tiles - 1;
            if(head.y >= this.tiles) head.y = 0;

            if(this.snake.some(s => s.x === head.x && s.y === head.y)) return this.end("Menabrak diri sendiri!");

            this.snake.unshift(head);
            const fi = this.foods.findIndex(f => f.x === head.x && f.y === head.y);
            
            if(fi !== -1) {
                if(this.foods[fi].correct) {
                    this.score += 100;
                    this.level++;
                    this.updateUI();
                    this.spawn();
                } else {
                    this.lives--;
                    this.updateUI();
                    document.getElementById('container').classList.add('flash-red');
                    setTimeout(() => document.getElementById('container').classList.remove('flash-red'), 400);
                    if(this.lives <= 0) return this.end("Hati habis!");
                    this.foods.splice(fi, 1);
                    this.snake.pop();
                }
            } else {
                this.snake.pop();
            }
            this.draw();
        }

        draw() {
            this.ctx.fillStyle = '#020617';
            this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);
            
            this.foods.forEach(f => {
                this.ctx.fillStyle = '#3b82f6';
                this.ctx.beginPath();
                this.ctx.roundRect(f.x*this.grid, f.y*this.grid, this.grid-2, this.grid-2, 4);
                this.ctx.fill();
                this.ctx.fillStyle = 'white';
                this.ctx.font = 'bold 10px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(f.text, f.x*this.grid + this.grid/2, f.y*this.grid + this.grid/2 + 4);
            });

            this.snake.forEach((s, i) => {
                this.ctx.fillStyle = i === 0 ? '#10b981' : '#34d399';
                this.ctx.beginPath();
                this.ctx.roundRect(s.x*this.grid, s.y*this.grid, this.grid-2, this.grid-2, 4);
                this.ctx.fill();
            });
        }

        end(r) {
            this.running = false;
            clearInterval(this.int);
            document.getElementById('over-screen').classList.remove('hidden');
            document.getElementById('reason').innerText = r;
        }

        win() {
            this.running = false;
            clearInterval(this.int);
            alert("Selamat! Kamu menang!");
            this.reset();
        }
    }

    const game = new Game();
</script>
</body>
</html>
